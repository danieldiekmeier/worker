<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-cron" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Recurring tasks (crontab) | Graphile Worker</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://worker.graphile.org/docs/cron"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Recurring tasks (crontab) | Graphile Worker"><meta data-rh="true" name="description" content="You can schedule a job to run in the future using the run_at property; however"><meta data-rh="true" property="og:description" content="You can schedule a job to run in the future using the run_at property; however"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://worker.graphile.org/docs/cron"><link data-rh="true" rel="alternate" href="https://worker.graphile.org/docs/cron" hreflang="en"><link data-rh="true" rel="alternate" href="https://worker.graphile.org/docs/cron" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.693cf020.css">
<link rel="preload" href="/assets/js/runtime~main.cf134e09.js" as="script">
<link rel="preload" href="/assets/js/main.539c36ad.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_oPtH" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Graphile Worker" class="themedImage_BQGR themedImage--light_HAxW"><img src="/img/logo.svg" alt="Graphile Worker" class="themedImage_BQGR themedImage--dark_bGx0"></div><b class="navbar__title text--truncate">Graphile Worker</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/graphile/worker" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPrP"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_ki11 colorModeToggle_Hewu"><button class="clean-btn toggleButton_MMFG toggleButtonDisabled_Uw7m" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_lgto"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_U96C"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_WqAV"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_MB5r docsWrapper_ct1J"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_iEvu" type="button"></button><div class="docPage_KLoz"><aside class="theme-doc-sidebar-container docSidebarContainer_y0RQ"><div class="sidebarViewport_EJ1r"><div class="sidebar_CUen"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_jmj1"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/requirements">Requirements</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/installation">Installation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/tasks">Task executors</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/cli">CLI</a><button aria-label="Toggle the collapsible sidebar category &#x27;CLI&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/library">Library</a><button aria-label="Toggle the collapsible sidebar category &#x27;Library&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/sql-add-job">Adding jobs through SQL</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/job-key">Job key</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/cron">Recurring tasks (crontab)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/admin-functions">Administrative functions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/forbidden-flags">Forbidden flags</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/performance">Performance</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/error-handling">Error handling</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/exponential-backoff">Exponential backoff</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/support">Support</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/docker">Docker</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/project-status">Project status</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/contributing">Contributing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/uninstall">Uninstall</a></li></ul></nav></div></div></aside><main class="docMainContainer_sTIZ"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_Qr34"><div class="docItemContainer_tjFy"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_T5ub" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_sfvy"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Recurring tasks (crontab)</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_wXna theme-doc-toc-mobile tocMobile_Ojys"><button type="button" class="clean-btn tocCollapsibleButton_iI2p">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Recurring tasks (crontab)</h1></header><p>You can schedule a job to run in the future using the <code>run_at</code> property; however
if you want to have jobs automatically created on a schedule then this is for
you.</p><h2 class="anchor anchorWithStickyNavbar_JmGV" id="recurring-schedule">Recurring schedule<a href="#recurring-schedule" class="hash-link" aria-label="Direct link to Recurring schedule" title="Direct link to Recurring schedule">​</a></h2><p>Graphile Worker supports triggering recurring tasks according to a cron-like
schedule. This is designed for recurring tasks such as sending a weekly email,
running database maintenance tasks every day, performing data roll-ups hourly,
downloading external data every 20 minutes, etc.</p><p>Graphile Worker&#x27;s crontab support:</p><ul><li>guarantees (thanks to ACID-compliant transactions) that no duplicate task
schedules will occur</li><li>can backfill missed jobs if desired (e.g. if the Worker wasn&#x27;t running when
the job was due to be scheduled)</li><li>schedules tasks using Graphile Worker&#x27;s regular job queue, so you get all the
regular features such as exponential back-off on failure.</li><li>works reliably even if you&#x27;re running multiple workers (see &quot;Distributed
crontab&quot; below)</li></ul><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_uH4V"><div class="admonitionHeading_P5_N"><span class="admonitionIcon_MF44"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_yySL"><p>It is not intended that you add recurring tasks for each of your individual
application users, instead you should have relatively few recurring tasks, and
those tasks can create additional jobs for the individual users (or process
multiple users) if necessary.</p></div></div><p>Tasks are by default read from a <code>crontab</code> file next to the <code>tasks/</code> folder (but
this is configurable in library mode). Please note that our syntax is not 100%
compatible with cron&#x27;s, and our task payload differs. We only handle timestamps
in UTC.</p><h2 class="anchor anchorWithStickyNavbar_JmGV" id="crontab-format"><code>crontab</code> format<a href="#crontab-format" class="hash-link" aria-label="Direct link to crontab-format" title="Direct link to crontab-format">​</a></h2><p>The following diagram details the parts of a Graphile Worker crontab schedule:</p><div class="language-crontab codeBlockContainer_mQmQ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_D5yF"><pre tabindex="0" class="prism-code language-crontab codeBlock_RMoD thin-scrollbar"><code class="codeBlockLines_AclH"><span class="token-line" style="color:#393A34"><span class="token plain"># ┌───────────── UTC minute (0 - 59)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># │ ┌───────────── UTC hour (0 - 23)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># │ │ ┌───────────── UTC day of the month (1 - 31)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># │ │ │ ┌───────────── UTC month (1 - 12)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># │ │ │ │ ┌───────────── UTC day of the week (0 - 6) (Sunday to Saturday)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># │ │ │ │ │ ┌───────────── task (identifier) to schedule</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># │ │ │ │ │ │    ┌────────── optional scheduling options</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># │ │ │ │ │ │    │     ┌────── optional payload to merge</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># │ │ │ │ │ │    │     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># │ │ │ │ │ │    │     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># * * * * * task ?opts {payload}</span><br></span></code></pre><div class="buttonGroup_aaMX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_z5j7" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_FoOz"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_L0B6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Comment lines start with a <code>#</code>.</p><p>For the first 5 fields we support an explicit numeric value, <code>*</code> to represent
all valid values, <code>*/n</code> (where <code>n</code> is a positive integer) to represent all valid
values divisible by <code>n</code>, range syntax such as <code>1-5</code>, and any combination of
these separated by commas.</p><p>The task identifier should match the following regexp
<code>/^[_a-zA-Z][_a-zA-Z0-9:_-]*$/</code> (namely it should start with an alphabetic
character and it should only contain alphanumeric characters, colon, underscore
and hyphen). It should be the name of one of your Graphile Worker tasks.</p><h3 class="anchor anchorWithStickyNavbar_JmGV" id="crontab-opts">Crontab <code>opts</code><a href="#crontab-opts" class="hash-link" aria-label="Direct link to crontab-opts" title="Direct link to crontab-opts">​</a></h3><p>The <code>opts</code> must always be prefixed with a <code>?</code> if provided and details
configuration for the task such as what should be done in the event that the
previous event was not scheduled (e.g. because the Worker wasn&#x27;t running).
Options are specified using HTTP query string syntax (with <code>&amp;</code> separator).</p><p>Currently we support the following <code>opts</code>:</p><ul><li><code>id=UID</code> where UID is a unique alphanumeric case-sensitive identifier starting
with a letter - specify an identifier for this crontab entry; by default this
will use the task identifier, but if you want more than one schedule for the
same task (e.g. with different payload, or different times) then you will need
to supply a unique identifier explicitly.</li><li><code>fill=t</code> where <code>t</code> is a &quot;time phrase&quot; (see below) - backfill any entries from
the last time period <code>t</code>, for example if the worker was not running when they
were due to be executed (by default, no backfilling).</li><li><code>max=n</code> where <code>n</code> is a small positive integer - override the <code>max_attempts</code> of
the job.</li><li><code>queue=name</code> where <code>name</code> is an alphanumeric queue name - add the job to a
named queue so it executes serially.</li><li><code>priority=n</code> where <code>n</code> is a relatively small integer - override the priority
of the job.</li></ul><div class="theme-admonition theme-admonition-warning alert alert--danger admonition_uH4V"><div class="admonitionHeading_P5_N"><span class="admonitionIcon_MF44"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>danger</div><div class="admonitionContent_yySL"><p>Changing the identifier (e.g. via <code>id</code>) can result in duplicate executions, so
we recommend that you explicitly set it and never change it.</p></div></div><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_uH4V"><div class="admonitionHeading_P5_N"><span class="admonitionIcon_MF44"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_yySL"><p>Using <code>fill</code> will not backfill new tasks, only tasks that were previously known.</p></div></div><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_uH4V"><div class="admonitionHeading_P5_N"><span class="admonitionIcon_MF44"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_yySL"><p>The higher you set the <code>fill</code> parameter, the longer the worker startup time will
be; when used you should set it to be slightly larger than the longest period of
downtime you expect for your worker.</p></div></div><h4 class="anchor anchorWithStickyNavbar_JmGV" id="time-phrase">Time phrase<a href="#time-phrase" class="hash-link" aria-label="Direct link to Time phrase" title="Direct link to Time phrase">​</a></h4><p>Time phrases are comprised of a sequence of number-letter combinations, where
the number represents a quantity and the letter represents a time period, e.g.
<code>5d</code> for <code>five days</code>, or <code>3h</code> for <code>three hours</code>; e.g. <code>4w3d2h1m</code> represents
<code>4 weeks, 3 days, 2 hours and 1 minute</code> (i.e. a period of 44761 minutes). The
following time periods are supported:</p><ul><li><code>s</code> - one second (1000 milliseconds)</li><li><code>m</code> - one minute (60 seconds)</li><li><code>h</code> - one hour (60 minutes)</li><li><code>d</code> - one day (24 hours)</li><li><code>w</code> - one week (7 days)</li></ul><h3 class="anchor anchorWithStickyNavbar_JmGV" id="payload"><code>payload</code><a href="#payload" class="hash-link" aria-label="Direct link to payload" title="Direct link to payload">​</a></h3><p>The <code>payload</code> is a JSON5 object; it must start with a <code>{</code>, must not contain
newlines or carriage returns (<code>\n</code> or <code>\r</code>), and must not contain trailing
whitespace. It will be merged into the default crontab payload properties.</p><p>Each crontab job will have a JSON object payload containing the key <code>_cron</code> with
the value being an object with the following entries:</p><ul><li><code>ts</code> - ISO8601 timestamp representing when this job was due to execute</li><li><code>backfilled</code> - true if the task was &quot;backfilled&quot; (i.e. it wasn&#x27;t scheduled on
time), false otherwise</li></ul><h2 class="anchor anchorWithStickyNavbar_JmGV" id="distributed-crontab">Distributed crontab<a href="#distributed-crontab" class="hash-link" aria-label="Direct link to Distributed crontab" title="Direct link to Distributed crontab">​</a></h2><p><strong>TL;DR</strong>: when running identical crontabs on multiple workers no special action
is necessary - it Just Works ™️</p><p>When you run multiple workers with the same crontab files then the first worker
that attempts to queue a particular cron job will succeed and the other workers
will take no action - this is thanks to SQL ACID-compliant transactions and our
<code>known_crontabs</code> lock table.</p><p>If your workers have different crontabs then you must be careful to ensure that
the cron items each have unique identifiers; the easiest way to do this is to
specify the identifiers yourself (see the <code>id=</code> option above). Should you forget
to do this then for any overlapping timestamps for items that have the same
derived identifier one of the cron tasks will schedule but the others will not.</p><h2 class="anchor anchorWithStickyNavbar_JmGV" id="examples">Examples<a href="#examples" class="hash-link" aria-label="Direct link to Examples" title="Direct link to Examples">​</a></h2><p>The following schedules the <code>send_weekly_email</code> task at 4:30am (UTC) every
Monday:</p><div class="codeBlockContainer_mQmQ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_D5yF"><pre tabindex="0" class="prism-code language-text codeBlock_RMoD thin-scrollbar"><code class="codeBlockLines_AclH"><span class="token-line" style="color:#393A34"><span class="token plain">30 4 * * 1 send_weekly_email</span><br></span></code></pre><div class="buttonGroup_aaMX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_z5j7" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_FoOz"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_L0B6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The following does similar, but also will backfill any tasks over the last two
days (<code>2d</code>), sets max attempts to <code>10</code> and merges in <code>{&quot;onboarding&quot;: false}</code>
into the task payload:</p><div class="codeBlockContainer_mQmQ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_D5yF"><pre tabindex="0" class="prism-code language-text codeBlock_RMoD thin-scrollbar"><code class="codeBlockLines_AclH"><span class="token-line" style="color:#393A34"><span class="token plain">30 4 * * 1 send_weekly_email ?fill=2d&amp;max=10 {onboarding:false}</span><br></span></code></pre><div class="buttonGroup_aaMX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_z5j7" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_FoOz"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_L0B6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The following triggers the <code>rollup</code> task every 4 hours on the hour:</p><div class="codeBlockContainer_mQmQ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_D5yF"><pre tabindex="0" class="prism-code language-text codeBlock_RMoD thin-scrollbar"><code class="codeBlockLines_AclH"><span class="token-line" style="color:#393A34"><span class="token plain">0 */4 * * * rollup</span><br></span></code></pre><div class="buttonGroup_aaMX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_z5j7" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_FoOz"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_L0B6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_JmGV" id="limiting-backfill">Limiting backfill<a href="#limiting-backfill" class="hash-link" aria-label="Direct link to Limiting backfill" title="Direct link to Limiting backfill">​</a></h2><p>When you ask Graphile Worker to backfill jobs, it will do so for all jobs
matching that specification that should have been scheduled over the backfill
period. Other than the period itself, you cannot place limits on the backfilling
(for example, you cannot say &quot;backfill at most one job&quot; or &quot;only backfill if the
next job isn&#x27;t due within the next 3 hours&quot;); this is because we&#x27;ve determined
that there&#x27;s many situations (back-off, overloaded worker, serially executed
jobs, etc.) in which the result of this behaviour might result in outcomes that
the user did not expect.</p><p>If you need these kinds of constraints on backfilled jobs, you should implement
them <em>at runtime</em> (rather than at scheduling time) in the task executor itself,
which could use the <code>payload._cron.ts</code> property to determine whether execution
should continue or not.</p><h2 class="anchor anchorWithStickyNavbar_JmGV" id="specifying-cron-items-in-library-mode">Specifying cron items in library mode<a href="#specifying-cron-items-in-library-mode" class="hash-link" aria-label="Direct link to Specifying cron items in library mode" title="Direct link to Specifying cron items in library mode">​</a></h2><p>You&#x27;ve three options for specifying cron tasks in library mode:</p><ol><li><code>crontab</code>: a crontab string (like the contents of a crontab file)</li><li><code>crontabFile</code>: the (string) path to a crontab file, from which to read the
rules</li><li><code>parsedCronItems</code>: explicit parsed cron items (see below)</li></ol><h3 class="anchor anchorWithStickyNavbar_JmGV" id="parsedcronitems">parsedCronItems<a href="#parsedcronitems" class="hash-link" aria-label="Direct link to parsedCronItems" title="Direct link to parsedCronItems">​</a></h3><p>The Graphile Worker internal format for cron items lists all the matching
minutes/hours/etc uniquely and in numerically ascending order. It also has other
requirements and is to be treated as an opaque type, so you must not construct
this value manually.</p><p>Instead, you may specify the parsedCronItems using one of the helper functions:</p><ol><li><code>parseCrontab</code>: pass a crontab string and it will be converted into a list of
<code>ParsedCronItem</code>s</li><li><code>parseCronItems</code>: pass a list of <code>CronItem</code>s and it will be converted into a
list of <code>ParsedCronItem</code>s</li></ol><p>The <code>CronItem</code> type is designed to be written by humans (and their scripts) and
has the following properties:</p><ul><li><code>task</code> (required): the string identifier of the task that should be executed
(same as the first argument to <code>add_job</code>)</li><li><code>pattern</code> (required): a cron pattern (e.g. <code>* * * * *</code>) describing when to run
this task</li><li><code>options</code>: optional options influencing backfilling, etc<ul><li><code>backfillPeriod</code>: how long (in milliseconds) to backfill (see above)</li><li><code>maxAttempts</code>: the maximum number of attempts we&#x27;ll give the job</li><li><code>queueName</code>: if you want the job to run serially, you can add it to a named
queue</li><li><code>priority</code>: optionally override the priority of the job</li></ul></li><li><code>payload</code>: an optional payload object to merge into the generated payload for
the job</li><li><code>identifier</code>: an optional string to give this cron item a permanent
identifier; if not given we will use the <code>task</code>. This is particularly useful
if you want to schedule the same task multiple times, perhaps on different
time patterns or with different payloads or other options (since every cron
item must have a unique identifier).</li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/graphile/worker/tree/main/website/docs/cron.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_bHB7" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_pbO5"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/job-key"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Job key</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/admin-functions"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Administrative functions</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_XG6w thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#recurring-schedule" class="table-of-contents__link toc-highlight">Recurring schedule</a></li><li><a href="#crontab-format" class="table-of-contents__link toc-highlight"><code>crontab</code> format</a><ul><li><a href="#crontab-opts" class="table-of-contents__link toc-highlight">Crontab <code>opts</code></a></li><li><a href="#payload" class="table-of-contents__link toc-highlight"><code>payload</code></a></li></ul></li><li><a href="#distributed-crontab" class="table-of-contents__link toc-highlight">Distributed crontab</a></li><li><a href="#examples" class="table-of-contents__link toc-highlight">Examples</a></li><li><a href="#limiting-backfill" class="table-of-contents__link toc-highlight">Limiting backfill</a></li><li><a href="#specifying-cron-items-in-library-mode" class="table-of-contents__link toc-highlight">Specifying cron items in library mode</a><ul><li><a href="#parsedcronitems" class="table-of-contents__link toc-highlight">parsedCronItems</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/graphile" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPrP"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/GraphileHQ" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPrP"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/graphile/worker" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPrP"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Graphile Ltd. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.cf134e09.js"></script>
<script src="/assets/js/main.539c36ad.js"></script>
</body>
</html>